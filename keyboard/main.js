(()=>{"use strict";class t{constructor(t,e="div",s="",i="",r=!0){const o=document.createElement(e);o.className=s,o.innerHTML=i,this.node=o,r?t.append(o):t.prepend(o)}}const e=JSON.parse('[[{"code":"Backquote","type":"Symbol","shift":{"en":"~"},"default":{"en":"`","ru":"ё"}},{"code":"Digit1","type":"Symbol","shift":{"en":"!"},"default":{"en":"1"}},{"code":"Digit2","type":"Symbol","shift":{"en":"@","ru":"\\""},"default":{"en":"2"}},{"code":"Digit3","type":"Symbol","shift":{"en":"#","ru":"№"},"default":{"en":"3"}},{"code":"Digit4","type":"Symbol","shift":{"en":"$","ru":";"},"default":{"en":"4"}},{"code":"Digit5","type":"Symbol","shift":{"en":"%"},"default":{"en":"5"}},{"code":"Digit6","type":"Symbol","shift":{"en":"^","ru":":"},"default":{"en":"6"}},{"code":"Digit7","type":"Symbol","shift":{"en":"&","ru":"?"},"default":{"en":"7"}},{"code":"Digit8","type":"Symbol","shift":{"en":"*"},"default":{"en":"8"}},{"code":"Digit9","type":"Symbol","shift":{"en":"("},"default":{"en":"9"}},{"code":"Digit0","type":"Symbol","shift":{"en":")"},"default":{"en":"0"}},{"code":"Minus","type":"Symbol","shift":{"en":"_"},"default":{"en":"-"}},{"code":"Equal","type":"Symbol","shift":{"en":"+"},"default":{"en":"="}},{"code":"Backspace","type":"Function","default":"Backspace"}],[{"code":"Tab","type":"Function","default":"Tab"},{"code":"KeyQ","type":"Symbol","default":{"en":"q","ru":"й"}},{"code":"KeyW","type":"Symbol","default":{"en":"w","ru":"ц"}},{"code":"KeyE","type":"Symbol","default":{"en":"e","ru":"у"}},{"code":"KeyR","type":"Symbol","default":{"en":"r","ru":"к"}},{"code":"KeyT","type":"Symbol","default":{"en":"t","ru":"е"}},{"code":"KeyY","type":"Symbol","default":{"en":"y","ru":"н"}},{"code":"KeyU","type":"Symbol","default":{"en":"u","ru":"г"}},{"code":"KeyI","type":"Symbol","default":{"en":"i","ru":"ш"}},{"code":"KeyO","type":"Symbol","default":{"en":"o","ru":"щ"}},{"code":"KeyP","type":"Symbol","default":{"en":"p","ru":"з"}},{"code":"BracketLeft","type":"Symbol","shift":{"en":"{"},"default":{"en":"[","ru":"х"}},{"code":"BracketRight","type":"Symbol","shift":{"en":"}"},"default":{"en":"]","ru":"ъ"}},{"code":"Backslash","type":"Symbol","shift":{"en":"|","ru":"/"},"default":{"en":"\\\\","ru":"\\\\"}},{"code":"Delete","type":"Function","default":"Del"}],[{"code":"CapsLock","type":"Function","default":"CapsLock"},{"code":"KeyA","type":"Symbol","default":{"en":"a","ru":"ф"}},{"code":"KeyS","type":"Symbol","default":{"en":"s","ru":"ы"}},{"code":"KeyD","type":"Symbol","default":{"en":"d","ru":"в"}},{"code":"KeyF","type":"Symbol","default":{"en":"f","ru":"а"}},{"code":"KeyG","type":"Symbol","default":{"en":"g","ru":"п"}},{"code":"KeyH","type":"Symbol","default":{"en":"h","ru":"р"}},{"code":"KeyJ","type":"Symbol","default":{"en":"j","ru":"о"}},{"code":"KeyK","type":"Symbol","default":{"en":"k","ru":"л"}},{"code":"KeyL","type":"Symbol","default":{"en":"l","ru":"д"}},{"code":"Semicolon","type":"Symbol","shift":{"en":":"},"default":{"en":";","ru":"ж"}},{"code":"Quote","type":"Symbol","shift":{"en":"\\""},"default":{"en":"\'","ru":"э"}},{"code":"Enter","type":"Function","default":"Enter"}],[{"code":"ShiftLeft","type":"Function","default":"Shift"},{"code":"KeyZ","type":"Symbol","default":{"en":"z","ru":"я"}},{"code":"KeyX","type":"Symbol","default":{"en":"x","ru":"ч"}},{"code":"KeyC","type":"Symbol","default":{"en":"c","ru":"с"}},{"code":"KeyV","type":"Symbol","default":{"en":"v","ru":"м"}},{"code":"KeyB","type":"Symbol","default":{"en":"b","ru":"и"}},{"code":"KeyN","type":"Symbol","default":{"en":"n","ru":"т"}},{"code":"KeyM","type":"Symbol","default":{"en":"m","ru":"ь"}},{"code":"Comma","type":"Symbol","shift":{"en":"<"},"default":{"en":",","ru":"б"}},{"code":"Period","type":"Symbol","shift":{"en":">"},"default":{"en":".","ru":"ю"}},{"code":"Slash","type":"Symbol","shift":{"en":"?","ru":","},"default":{"en":"/","ru":"."}},{"code":"ArrowUp","type":"Function","default":"↑"},{"code":"ShiftRight","type":"Function","default":"Shift"}],[{"code":"ControlLeft","type":"Function","default":"Ctrl"},{"code":"MetaLeft","type":"Function","default":"Win"},{"code":"AltLeft","type":"Function","default":"Alt"},{"code":"Space","type":"Function","default":""},{"code":"AltRight","type":"Function","default":"Alt"},{"code":"ArrowLeft","type":"Function","default":"←"},{"code":"ArrowDown","type":"Function","default":"↓"},{"code":"ArrowRight","type":"Function","default":"→"},{"code":"ControlRight","type":"Function","default":"Ctrl"}]]');class s extends t{constructor(t,e,s){super(t,"div",e),this.code=s,this.onKey=()=>{},this.node.onmousedown=()=>{this.onKey()}}}class i extends s{constructor(t,e,s){super(t,"key",e),this.node.textContent=s,this.node.className=`${this.node.className} key_${s.toLowerCase()}`}}class r extends s{constructor(t,e,s,i,r){super(t,"key",e),this.defaultValue=s,this.shiftValue=i,this.lang=r,this.defaultValue[`${this.lang}`]?this.node.textContent=this.defaultValue[`${this.lang}`]:this.node.textContent=this.defaultValue.en}getSymbol(){return this.node.textContent}caps(t){this.isCaps=t,this.isCaps||this.isShift?this.node.textContent=this.node.textContent.toUpperCase():this.node.textContent=this.node.textContent.toLowerCase()}shift(t){this.isShift=t,this.isShift?this.shiftValue?this.shiftValue[`${this.lang}`]?this.node.textContent=this.shiftValue[`${this.lang}`].toUpperCase():this.defaultValue[`${this.lang}`]?this.node.textContent=this.defaultValue[`${this.lang}`].toUpperCase():this.node.textContent=this.shiftValue.en:this.defaultValue[`${this.lang}`]?this.node.textContent=this.defaultValue[`${this.lang}`].toUpperCase():this.node.textContent=this.defaultValue.en.toUpperCase():this.isCaps?this.defaultValue[`${this.lang}`]?this.node.textContent=this.defaultValue[`${this.lang}`].toUpperCase():this.node.textContent=this.defaultValue.en.toUpperCase():this.defaultValue[`${this.lang}`]?this.node.textContent=this.defaultValue[`${this.lang}`]:this.node.textContent=this.defaultValue.en}switchLang(t){this.lang=t,this.node.textContent=this.defaultValue[`${t}`]||this.defaultValue.en,this.isShift&&this.shift(this.isShift),this.isCaps&&this.caps(this.isCaps)}}class o extends t{constructor(e,s,i){super(e,"div",s);const r=new t(this.node,"div","keyboard");this.rows=[new t(r.node,"div","keyboard__row"),new t(r.node,"div","keyboard__row"),new t(r.node,"div","keyboard__row"),new t(r.node,"div","keyboard__row"),new t(r.node,"div","keyboard__row")],this.lang=i,this.renderKeyboard()}renderKeyboard(){this.keyList=[],e.forEach(((t,e)=>{t.forEach((t=>{"Symbol"===t.type?this.keyList.push(new r(this.rows[e].node,t.code,t.default,t.shift,this.lang)):this.keyList.push(new i(this.rows[e].node,t.code,t.default))}))})),this.onKeys()}onKeys(){this.keyList.forEach((t=>{const e=t;e.onKey=()=>{this.pressKey=e,this.isPress=!0}}))}setPressKey(t){this.pressKey=this.keyList.find((e=>e.code===t.code)),this.isPress=!0}getPressKey(){return this.isPress?this.pressKey:null}onCapsLock(t){this.keyList.forEach((e=>{e.caps&&e.caps(t)}))}onShift(t){this.keyList.forEach((e=>{e.shift&&e.shift(t)}))}onMark(t){t&&(this.markKey=this.keyList.find((e=>e.code===t.code))||null,this.markKey&&this.markKey.node.classList.toggle("mark"))}offMark(t){t&&(this.markKey=this.keyList.find((e=>e.code===t.code))||null,this.markKey&&this.markKey.node.classList.remove("mark"))}switchLang(t){this.keyList.forEach((e=>{e.switchLang&&e.switchLang(t)}))}resetKeyboard(){this.keyList.forEach((t=>{t.code.match(/Caps/)||this.offMark(t)}))}}class h extends t{constructor(t,e){super(t,"textarea",e),this.node.value=""}getCursorData(){const t=this.node.selectionStart,e=this.node.selectionEnd;return{cursorStart:t,cursorEnd:e,beforeCursor:this.node.value.slice(0,t),afterCursor:this.node.value.slice(e)}}printSymbol(t){const{beforeCursor:e,afterCursor:s}=this.getCursorData();let{cursorStart:i}=this.getCursorData();this.node.value=e+t+s,i+=1,this.node.setSelectionRange(i,i)}backspace(){const{cursorEnd:t,beforeCursor:e,afterCursor:s}=this.getCursorData();let{cursorStart:i}=this.getCursorData();i===t?i>0&&(this.node.value=e.slice(0,e.length-1)+s,i-=1):this.node.value=e+s,this.node.setSelectionRange(i,i)}delete(){const{cursorStart:t,cursorEnd:e,beforeCursor:s,afterCursor:i}=this.getCursorData();this.node.value=t===e?s+i.slice(1):s+i,this.node.setSelectionRange(t,t)}tab(){const{beforeCursor:t,afterCursor:e}=this.getCursorData();let{cursorStart:s}=this.getCursorData();this.node.value=`${t}\t${e}`,s+=1,this.node.setSelectionRange(s,s)}space(){const{beforeCursor:t,afterCursor:e}=this.getCursorData();let{cursorStart:s}=this.getCursorData();this.node.value=`${t} ${e}`,s+=1,this.node.setSelectionRange(s,s)}enter(){const{beforeCursor:t,afterCursor:e}=this.getCursorData();let{cursorStart:s}=this.getCursorData();this.node.value=`${t}\n${e}`,s+=1,this.node.setSelectionRange(s,s)}arrowRight(){let{cursorStart:t}=this.getCursorData();t+=1,this.node.setSelectionRange(t,t)}arrowLeft(){let{cursorStart:t}=this.getCursorData();t>0&&(t-=1,this.node.setSelectionRange(t,t))}arrowUp(){const{beforeCursor:t,afterCursor:e}=this.getCursorData();let{cursorStart:s}=this.getCursorData();this.node.value=`${t}↑${e}`,s+=1,this.node.setSelectionRange(s,s)}arrowDown(){const{beforeCursor:t,afterCursor:e}=this.getCursorData();let{cursorStart:s}=this.getCursorData();this.node.value=`${t}↓${e}`,s+=1,this.node.setSelectionRange(s,s)}select(t){let{cursorStart:e,cursorEnd:s}=this.getCursorData();s===e&&(this.selectDirection=t),this.selectDirection===t?t?(s+=1,this.node.setSelectionRange(e,s)):e>0&&(e-=1,this.node.setSelectionRange(e,s)):s>e&&(t?(e+=1,this.node.setSelectionRange(e,s)):(s-=1,this.node.setSelectionRange(e,s)))}selectAll(){this.node.select()}copy(){const{cursorStart:t,cursorEnd:e}=this.getCursorData();if(t===e)return null;const{value:s}=this.node;return s.slice(t,e)}cut(){const{cursorStart:t}=this.getCursorData(),{cursorEnd:e,beforeCursor:s,afterCursor:i}=this.getCursorData();if(t===e)return null;const{value:r}=this.node,o=r.slice(t,e);return this.node.value=s+i,this.node.setSelectionRange(t,t),o}paste(t){const{beforeCursor:e,afterCursor:s}=this.getCursorData();let{cursorStart:i}=this.getCursorData();t&&(this.node.value=e+t+s,i+=t.length,this.node.setSelectionRange(i,i))}}new class extends t{constructor(t){super(t,"div","app"),this.isCaps=!1,this.isShift=!1,this.isCtrl=!1,this.isAlt=!1,this.node.setAttribute("tabindex","1"),this.node.focus(),this.node.onkeydown=t=>{if(this.keyboard.setPressKey(t),this.pressKey=this.keyboard.getPressKey(),this.keyboard.isPress=!1,this.pressKey){if(this.pressKey.code.match(/Caps/))return void this.caps();if(t.code.match(/Shift/))return this.isShift=!1,this.resetKeys({isAlt:this.isAlt,isShift:!0,isCtrl:this.isCtrl}),void this.keyboard.onMark(t);if(t.code.match(/Control/))return this.isCtrl=!0,this.isAlt&&(this.switchLang(),this.rename()),this.resetKeys({isAlt:this.isAlt,isShift:this.isShift,isCtrl:!1}),void this.keyboard.onMark(t);if(t.code.match(/Alt/))return this.isAlt=!0,this.isCtrl&&(this.switchLang(),this.rename()),this.resetKeys({isAlt:!1,isShift:this.isShift,isCtrl:this.isCtrl}),void this.keyboard.onMark(t);if(this.pressKey.getSymbol)return this.checkCombs(t),void t.preventDefault();this.keyboard.onMark(t),this.textArea.node.focus()}},this.node.onkeyup=t=>{t.code.match(/Caps/)||(t.code.match(/Shift/)&&this.isShift&&(this.isShift=!this.isShift,this.keyboard.onShift(this.isShift)),t.code.match(/Control/)&&this.isCtrl&&(this.isCtrl=!this.isCtrl),t.code.match(/Alt/)&&this.isAlt&&(this.isAlt=!this.isAlt),this.keyboard.offMark(t))},this.node.onmousedown=()=>{if(this.pressKey=this.keyboard.getPressKey(),this.keyboard.isPress=!1,this.pressKey){if(this.pressKey.getSymbol)return void this.checkCombs();if(this.pressKey.code.match(/Shift/))return void this.shift();if(this.pressKey.code.match(/Control/))return void this.ctrl();if(this.pressKey.code.match(/Alt/))return void this.alt();if(this.pressKey.code.match(/Caps/))return void this.caps();if(this.pressKey.code.match(/Backspace/)&&this.backspace(),this.pressKey.code.match(/Delete/)&&this.delete(),this.pressKey.code.match(/Tab/)&&this.tab(),this.pressKey.code.match(/Enter/)&&this.enter(),this.pressKey.code.match(/Space/)&&this.space(),this.pressKey.code.match(/Arrow/))return void this.arrow();this.keyboard.onMark(this.pressKey),this.resetKeys({isAlt:this.isAlt,isShift:this.isShift,isCtrl:this.isCtrl})}},this.node.onmouseup=()=>{if(this.pressKey){if(this.pressKey.code.match(/Shift/))return;if(this.pressKey.code.match(/Caps/))return;if(this.pressKey.code.match(/Control/))return;if(this.pressKey.code.match(/Alt/))return;this.textArea.node.focus(),this.keyboard.offMark(this.pressKey)}}}getLang(){localStorage.getItem("lang")?this.lang=localStorage.getItem("lang"):this.lang="en",this.renderKeyboard()}renderKeyboard(){const e=new t(this.node,"div","container");this.title=new t(e.node,"h1","title"),"en"===this.lang?this.title.node.textContent="RSS Virtual Keyboard":this.title.node.textContent="RSS Виртуальная клавиатура",this.textArea=new h(e.node,"textarea"),this.keyboard=new o(e.node,"keyboard-wrap",this.lang),new t(e.node,"h4","subtitle").node.textContent="OS Linux, switch lang: ctrl+alt or alt+ctrl",window.onblur=()=>{this.resetKeyboard()}}resetKeyboard(){this.resetKeys({isAlt:this.isAlt,isShift:!1,isCtrl:this.isCtrl}),this.keyboard.resetKeyboard()}resetKeys(t){const{isAlt:e,isShift:s,isCtrl:i}=t;e&&(this.isAlt=!this.isAlt,this.keyboard.offMark(this.pressAlt)),s&&(this.isShift=!this.isShift,this.keyboard.onShift(this.isShift),this.keyboard.offMark(this.pressShift)),i&&(this.isCtrl=!this.isCtrl,this.keyboard.offMark(this.pressCtrl))}shift(){if(this.isShift){if(this.pressKey===this.pressShift)return void this.resetKeys({isAlt:!1,isShift:this.isShift,isCtrl:!1});this.keyboard.offMark(this.pressShift)}else this.isShift=!this.isShift,this.keyboard.onShift(this.isShift);this.pressShift=this.pressKey,this.keyboard.onMark(this.pressKey),this.resetKeys({isAlt:this.isAlt,isShift:!1,isCtrl:this.isCtrl})}ctrl(){if(this.isCtrl){if(this.pressKey===this.pressCtrl)return void this.resetKeys({isAlt:!1,isShift:!1,isCtrl:this.isCtrl});this.keyboard.offMark(this.pressCtrl)}else this.isCtrl=!this.isCtrl;this.pressCtrl=this.pressKey,this.keyboard.onMark(this.pressKey),this.isAlt&&(this.switchLang(),this.rename(),setTimeout((()=>{this.resetKeys({isAlt:!1,isShift:!1,isCtrl:this.isCtrl})}),66)),this.resetKeys({isAlt:this.isAlt,isShift:this.isShift,isCtrl:!1})}alt(){if(this.isAlt){if(this.pressKey===this.pressAlt)return void this.resetKeys({isAlt:this.isAlt,isShift:!1,isCtrl:!1});this.keyboard.offMark(this.pressAlt)}else this.isAlt=!this.isAlt;this.pressAlt=this.pressKey,this.keyboard.onMark(this.pressKey),this.isCtrl&&(this.switchLang(),this.rename(),setTimeout((()=>{this.resetKeys({isAlt:this.isAlt,isShift:!1,isCtrl:!1})}),66)),this.resetKeys({isAlt:!1,isShift:this.isShift,isCtrl:this.isCtrl})}caps(){this.isCaps?this.keyboard.offMark(this.pressKey):this.keyboard.onMark(this.pressKey),this.isCaps=!this.isCaps,this.keyboard.onCapsLock(this.isCaps)}checkCombs(t){if(this.isCtrl){if(this.pressKey.code.match(/KeyA/))return this.textArea.node.focus(),this.textArea.selectAll(),this.keyboard.onMark(this.pressKey),void this.resetKeys({isAlt:this.isAlt,isShift:this.isShift,isCtrl:this.isCtrl});if(this.pressKey.code.match(/KeyC/))return t&&t.preventDefault(),this.buffer=this.textArea.copy(),this.keyboard.onMark(this.pressKey),void this.resetKeys({isAlt:this.isAlt,isShift:this.isShift,isCtrl:this.isCtrl});if(this.pressKey.code.match(/KeyX/))return t&&t.preventDefault(),this.textArea.node.focus(),this.buffer=this.textArea.cut(),this.keyboard.onMark(this.pressKey),void this.resetKeys({isAlt:this.isAlt,isShift:this.isShift,isCtrl:this.isCtrl});if(this.pressKey.code.match(/KeyV/))return this.textArea.paste(this.buffer),this.keyboard.onMark(this.pressKey),void this.resetKeys({isAlt:this.isAlt,isShift:this.isShift,isCtrl:this.isCtrl})}this.symbol()}symbol(){const t=this.pressKey.getSymbol();this.textArea.printSymbol(t),this.keyboard.onMark(this.pressKey),this.resetKeys({isAlt:this.isAlt,isShift:!1,isCtrl:this.isCtrl})}backspace(){this.textArea.backspace()}delete(){this.textArea.delete()}tab(){this.textArea.tab()}space(){this.textArea.space()}enter(){this.textArea.enter()}arrow(){this.pressKey.code.match(/Right/)?this.isShift?(this.isRightDirection=!0,this.textArea.select(this.isRightDirection)):this.textArea.arrowRight():this.pressKey.code.match(/Left/)?this.isShift?(this.isRightDirection=!1,this.textArea.select(this.isRightDirection)):this.textArea.arrowLeft():this.pressKey.code.match(/Up/)?this.textArea.arrowUp():this.pressKey.code.match(/Down/)&&this.textArea.arrowDown()}switchLang(){"en"===this.lang?this.lang="ru":this.lang="en",localStorage.setItem("lang",this.lang),this.keyboard.switchLang(this.lang)}rename(){"en"===this.lang?this.title.node.textContent="RSS Virtual Keyboard":this.title.node.textContent="RSS Виртуальная клавиатура"}}(document.body).getLang()})();
//# sourceMappingURL=main.js.map